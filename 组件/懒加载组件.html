<!DOCTYPE html>
<html>
<head>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <meta charset="utf-8">
  <title>懒加载组件</title>
  <style>
     .wrapper{
      width: 1000px;
      margin: 0 auto;
      text-align: center;
    }


    .wrapper>li{
      list-style: none;
      display: inline-block;
      margin: 30px;
      width: 300px;
    }

    li img{
      width: 100%;
    }     
  </style>
</head>
<body>
  <ul class="wrapper">
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/2.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/5.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/3.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/4.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/6.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/7.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/8.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/9.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/10.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/11.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/12.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/13.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/14.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/15.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/16.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/17.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/3.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/4.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/6.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/7.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/8.jpg'></a></li>
    <li><a href=""><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src='http://cdn.jirengu.com/book.jirengu.com/img/9.jpg'></a></li>


  </ul>
  <script>
    var LazyRender  = (function(){
	  	function Lazy($target){
				this.$target = $target
				this.render()
				this.bind()
			}

			Lazy.prototype.bind = function(){
				var _this = this
		    $(window).on('scroll',function(){
		      if(this.clock){
		        this.clearTimeout(clock)
		      }
		      this.clock = setTimeout(function(){
		        _this.render()

		      },300)
		    })
		  }

		  Lazy.prototype.render = function(){
		  	var $img = this.$img= this.$target.find("img")
		  	console.log(this.$img)
		  	var _this = this
		  	$img.each(function(index,value){
		      if (_this.isVisible(value) && !_this.isLoading(value)){
		        _this.loadImg(value)
		      }
		     })
		   }    


		  Lazy.prototype.isVisible = function(node){
		  	console.log(3)
		    var windowHeight = $(window).height()
		    var scrollTop = $(window).scrollTop()
		    var offsetTop = $(node).offset().top
		    if (offsetTop < windowHeight + scrollTop && offsetTop > scrollTop){
		      return true
		    }
		    return false    	
		  }


		  Lazy.prototype.isLoading = function(node){
		  	console.log(1)
		    return $(node).attr('src') === $(node).attr('data-src')
		  }


		  Lazy.prototype.loadImg = function(node){
		  	console.log(2)
		    $(node).attr('src',$(node).attr('data-src'))
		  } 

    	return{

    		init: function($target){
    						new Lazy($target)
    					}

    	}
    })()

    LazyRender.init($('.wrapper'))
     
  </script>
</body>
</html>